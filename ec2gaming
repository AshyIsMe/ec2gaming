
#!/usr/bin/env bash
cd "$(dirname "$0")" || exit

COMMANDS=($(find . -name 'ec2gaming-*.sh' | sed 's/.*ec2gaming-//;s/\.sh//'))

if [ -z ${1+x} ]; then
    echo "macOS EC2 Gaming with Steam In-Home Streaming"
    echo
    echo "usage: ec2gaming <command>"
    echo
    echo "Gaming commands"
    echo "start     Start gaming"
    echo "stop      Stop gaming"
    echo
    echo "Maintenance commands"
    echo "rdp       Remote desktop connection (no VPN, requires login)"
    echo "snapshot  Snapshot the instance and recreate AMI"
    echo "vnc       VNC session (requires VPN, automatic login)"
    echo
    echo "All supported commands"
    printf '%s\n' "${COMMANDS[@]}"
    echo
    echo "For help, go to https://www.reddit.com/r/cloudygamer/"
    exit
fi

if [[ ! " ${COMMANDS[@]} " =~ " ${1} " ]]; then
    echo "Unknown command '$1'. Supported commands:"
    printf '%s\n' "${COMMANDS[@]}"
    exit 1
else
    ./ec2gaming-$1.sh
fi

